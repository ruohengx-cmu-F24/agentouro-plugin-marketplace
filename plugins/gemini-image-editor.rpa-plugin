{
  "packageInfo": {
    "name": "Gemini Image Editor",
    "version": "1.0.0",
    "type": "rpa-plugin"
  },
  "files": {
    "plugin.json": "{\n  \"id\": \"plugin-gemini-image-editor\",\n  \"name\": \"Gemini Image Editor\",\n  \"description\": \"Use google's \\\"Nano Banana\\\" to edit an image\",\n  \"longDescription\": \"Use google's \\\"Nano Banana\\\" to edit an image based on the prompt passed in. In order to use the service, the user should having a gemini api key to get start. Please follow the instructions in the link to get one: https://aistudio.google.com/app/api-keys\",\n  \"category\": [\n    \"AI\",\n    \"Image Processing\"\n  ],\n  \"version\": \"1.0.0\",\n  \"author\": \"AgentOuro\",\n  \"type\": \"pluginNode\",\n  \"nodeType\": \"pluginNode\",\n  \"color\": \"#6b7280\",\n  \"createdAt\": \"2025-09-04T03:47:01.575Z\",\n  \"updatedAt\": \"2025-10-09T05:44:24.547Z\",\n  \"inputFields\": [\n    {\n      \"id\": \"field_1756957492921\",\n      \"type\": \"text\",\n      \"label\": \"Input 1\",\n      \"variableName\": \"api_key\",\n      \"required\": true,\n      \"defaultValue\": null\n    },\n    {\n      \"id\": \"field_1756957527595\",\n      \"type\": \"text\",\n      \"label\": \"Input 2\",\n      \"variableName\": \"prompt\",\n      \"required\": true,\n      \"defaultValue\": null\n    },\n    {\n      \"id\": \"field_1756957532021\",\n      \"type\": \"image\",\n      \"label\": \"Input 3\",\n      \"variableName\": \"image\",\n      \"required\": true,\n      \"defaultValue\": null\n    }\n  ],\n  \"outputFields\": [\n    {\n      \"id\": \"output_1756957538327\",\n      \"type\": \"image\",\n      \"label\": \"Output 1\",\n      \"variableName\": \"result\"\n    }\n  ],\n  \"globalVariableAccess\": []\n}",
    "index.py": "\"\"\"\nPlugin: Gemini Image Editor (SDK)\nDescription: Edit an image with Google's Gemini using the official SDK.\nGenerated by RPA Plugin Builder\n\"\"\"\n\ndef run(inputs, ctx):\n    \"\"\"\n    Edit an image using Google Gemini via google-genai SDK.\n\n    Required inputs:\n      - api_key (string): Google Generative Language API key\n      - prompt  (string): Edit instruction describing what to change\n      - image   (string): Base64 image (data URI allowed)\n\n    Returns:\n      - { \"result\": <base64 PNG string> }\n    \"\"\"\n    import base64\n    from io import BytesIO\n    from google import genai\n    from PIL import Image\n\n    # ---- Inputs ----\n    api_key = (inputs.get(\"api_key\") or \"\").strip()\n    prompt  = (inputs.get(\"prompt\") or \"\").strip()\n    image_b64 = (inputs.get(\"image\") or \"\").strip()\n\n    # ---- Validate ----\n    missing = []\n    if not api_key: missing.append(\"api_key\")\n    if not prompt:  missing.append(\"prompt\")\n    if not image_b64: missing.append(\"image\")\n    if missing:\n        raise ValueError(f\"Missing required inputs: {', '.join(missing)}\")\n\n    # ---- Normalize base64 (strip data URI if present) ----\n    if image_b64.startswith(\"data:\"):\n        try:\n            image_b64 = image_b64.split(\",\", 1)[1]\n        except Exception:\n            raise ValueError(\"Invalid data URI format for 'image'\")\n\n    # ---- Decode to PIL image ----\n    try:\n        img_bytes = base64.b64decode(image_b64)\n    except Exception as e:\n        raise ValueError(f\"Invalid base64 image: {e}\")\n\n    try:\n        input_image = Image.open(BytesIO(img_bytes))\n    except Exception as e:\n        raise ValueError(f\"Failed to open image: {e}\")\n\n    # Ensure a standard mode to avoid edge cases\n    if input_image.mode not in (\"RGB\", \"RGBA\"):\n        input_image = input_image.convert(\"RGB\")\n\n    # ---- Gemini call via SDK ----\n    try:\n        client = genai.Client(api_key=api_key)\n        response = client.models.generate_content(\n            model=\"gemini-2.5-flash-image-preview\",\n            contents=[prompt, input_image],\n        )\n    except Exception as e:\n        raise RuntimeError(f\"Gemini SDK request failed: {e}\")\n\n    # ---- Parse response for inline image ----\n    image_bytes_out = None\n    try:\n        candidates = getattr(response, \"candidates\", None) or []\n        if candidates and getattr(candidates[0], \"content\", None):\n            parts = getattr(candidates[0].content, \"parts\", None) or []\n            for part in parts:\n                inline = getattr(part, \"inline_data\", None)\n                if inline and getattr(inline, \"data\", None):\n                    image_bytes_out = inline.data\n                    break\n    except Exception as e:\n        raise RuntimeError(f\"Failed to parse Gemini response: {e}\")\n\n    if not image_bytes_out:\n        # Try to surface any returned text for easier debugging\n        returned_texts = []\n        try:\n            if candidates and getattr(candidates[0], \"content\", None):\n                for p in candidates[0].content.parts or []:\n                    if getattr(p, \"text\", None):\n                        returned_texts.append(p.text)\n        except Exception:\n            pass\n        hint = f\" (got text: {returned_texts[0][:120]}...)\" if returned_texts else \"\"\n        raise RuntimeError(f\"Gemini returned no image data{hint}\")\n\n    # ---- Convert resulting bytes to base64 PNG ----\n    try:\n        # Some responses are already raw PNG/JPEG bytes; attempt to open with PIL\n        result_img = Image.open(BytesIO(image_bytes_out))\n        buf = BytesIO()\n        result_img.save(buf, format=\"PNG\")\n        buf.seek(0)\n        b64_out = base64.b64encode(buf.read()).decode(\"utf-8\")\n    except Exception:\n        # If PIL fails, return the inline bytes as-is (assumed already image bytes)\n        try:\n            b64_out = base64.b64encode(image_bytes_out).decode(\"utf-8\")\n        except Exception as e:\n            raise RuntimeError(f\"Failed to encode result image: {e}\")\n\n    ctx.log(\"Gemini image edit succeeded\")\n    return {\"result\": b64_out}"
  }
}