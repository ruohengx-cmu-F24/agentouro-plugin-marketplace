{
  "packageInfo": {
    "name": "Gemini Image Generation",
    "version": "1.0.0",
    "type": "rpa-plugin"
  },
  "files": {
    "plugin.json": "{\n  \"id\": \"plugin-gemini-image-generation\",\n  \"name\": \"Gemini Image Generation\",\n  \"description\": \"Use google's \\\"Nano Banana\\\" to generate images\",\n  \"longDescription\": \"Use google's \\\"Nano Banana\\\" to generate images. In order to use the service, the user should having a gemini api key to get start. Please follow the instructions in the link to get one: https://aistudio.google.com/app/api-keys\",\n  \"category\": [\n    \"AI\",\n    \"Image Processing\"\n  ],\n  \"version\": \"1.0.0\",\n  \"author\": \"AgentOuro\",\n  \"type\": \"pluginNode\",\n  \"nodeType\": \"pluginNode\",\n  \"color\": \"#6b7280\",\n  \"createdAt\": \"2025-09-04T04:43:17.118Z\",\n  \"updatedAt\": \"2025-11-04T03:33:08.410Z\",\n  \"timeout_mode\": \"standard\",\n  \"inputFields\": [\n    {\n      \"id\": \"field_1756960967082\",\n      \"type\": \"text\",\n      \"label\": \"Input 1\",\n      \"variableName\": \"api_key\",\n      \"required\": true,\n      \"defaultValue\": null\n    },\n    {\n      \"id\": \"field_1756960972693\",\n      \"type\": \"text\",\n      \"label\": \"Input 2\",\n      \"variableName\": \"prompt\",\n      \"required\": true,\n      \"defaultValue\": null\n    }\n  ],\n  \"outputFields\": [\n    {\n      \"id\": \"output_1756960981527\",\n      \"type\": \"image\",\n      \"label\": \"Output 1\",\n      \"variableName\": \"result\"\n    }\n  ],\n  \"globalVariableAccess\": [],\n  \"dependencies\": [\n    \"google-genai\",\n    \"pillow\"\n  ]\n}",
    "index.py": "def run(inputs, ctx):\n    \"\"\"\n    Gemini 2.5 Flash â€” image generation\n    \"\"\"\n    import base64\n    from io import BytesIO\n    from google import genai\n    from PIL import Image\n\n    api_key = (inputs.get('api_key') or '').strip()\n    prompt  = (inputs.get('prompt') or '').strip()\n\n    if not api_key:\n        return {\"error\": \"api_key is required\"}\n\n    if not prompt:\n        return {\"error\": \"prompt is required\"}\n\n    try:\n        client = genai.Client(api_key=api_key)\n\n        response = client.models.generate_content(\n            model=\"gemini-2.5-flash-image-preview\",\n            contents=prompt,\n        )\n\n        if not response or not response.candidates:\n            return {\"error\": \"Empty response from Gemini API\"}\n\n        candidate = response.candidates[0]\n        if not candidate.content or not candidate.content.parts:\n            return {\"error\": \"No content parts in response\"}\n\n        image_parts = [\n            part.inline_data.data\n            for part in candidate.content.parts\n            if part.inline_data\n        ]\n\n        if not image_parts:\n            return {\"error\": \"No images found in response\"}\n\n        first_image_data = image_parts[0]\n\n        # Handle base64-encoded data (newer SDK versions return base64 as bytes)\n        if isinstance(first_image_data, bytes):\n            try:\n                # Check if it's base64 text in bytes format\n                first_image_data.decode('ascii')\n                first_image_bytes = base64.b64decode(first_image_data)\n            except (UnicodeDecodeError, ValueError):\n                # Raw binary image data\n                first_image_bytes = first_image_data\n        elif isinstance(first_image_data, str):\n            # Base64 string\n            first_image_bytes = base64.b64decode(first_image_data)\n        else:\n            raise ValueError(f\"Unexpected data type: {type(first_image_data)}\")\n\n        # Open and convert to PNG\n        img = Image.open(BytesIO(first_image_bytes))\n        buf = BytesIO()\n        img.save(buf, format='PNG')\n        png_bytes = buf.getvalue()\n\n        # Encode to base64\n        result_base64 = base64.b64encode(png_bytes).decode(\"utf-8\")\n\n        ctx.log(\"Image generation succeeded\")\n\n        return {\n            \"result\": result_base64\n        }\n\n    except Exception as e:\n        error_msg = f\"Image generation failed: {str(e)}\"\n        ctx.log(f\"ERROR: {error_msg}\")\n        return {\"error\": error_msg}"
  }
}