{
  "packageInfo": {
    "name": "Google Image Mixer",
    "version": "1.0.0",
    "type": "rpa-plugin"
  },
  "files": {
    "plugin.json": "{\n  \"id\": \"plugin-google-image-mixer\",\n  \"name\": \"Google Image Mixer\",\n  \"description\": \"Use google's \\\"Nano Banana\\\" to mix to photos\",\n  \"longDescription\": \"Use google's \\\"Nano Banana\\\" to mix to photos. In order to use the service, the user should having a gemini api key to get start. Please follow the instructions in the link to get one: https://aistudio.google.com/app/api-keys\",\n  \"category\": [\n    \"AI\",\n    \"Image Processing\"\n  ],\n  \"version\": \"1.0.0\",\n  \"author\": \"AgentOuro\",\n  \"type\": \"pluginNode\",\n  \"nodeType\": \"pluginNode\",\n  \"color\": \"#6b7280\",\n  \"createdAt\": \"2025-09-04T04:46:23.447Z\",\n  \"updatedAt\": \"2025-11-03T23:18:52.237Z\",\n  \"timeout_mode\": \"standard\",\n  \"inputFields\": [\n    {\n      \"id\": \"field_1756961134937\",\n      \"type\": \"text\",\n      \"label\": \"Input 1\",\n      \"variableName\": \"api_key\",\n      \"required\": true,\n      \"defaultValue\": null\n    },\n    {\n      \"id\": \"field_1756961148611\",\n      \"type\": \"image\",\n      \"label\": \"Input 3\",\n      \"variableName\": \"image1\",\n      \"required\": true,\n      \"defaultValue\": null\n    },\n    {\n      \"id\": \"field_1756961159236\",\n      \"type\": \"image\",\n      \"label\": \"Input 4\",\n      \"variableName\": \"image2\",\n      \"required\": false,\n      \"defaultValue\": null\n    },\n    {\n      \"id\": \"field_1756961141972\",\n      \"type\": \"text\",\n      \"label\": \"Input 2\",\n      \"variableName\": \"prompt\",\n      \"required\": true,\n      \"defaultValue\": null\n    }\n  ],\n  \"outputFields\": [\n    {\n      \"id\": \"output_1756961172262\",\n      \"type\": \"image\",\n      \"label\": \"Output 1\",\n      \"variableName\": \"result\"\n    }\n  ],\n  \"globalVariableAccess\": [],\n  \"dependencies\": [\n    \"google-genai\",\n    \"pillow\"\n  ]\n}",
    "index.py": "def run(inputs, ctx):\n    \"\"\"\n    Gemini Image Mixer - Combine two images using Google's Gemini model\n\n    Required inputs:\n      - api_key (string): Google Generative Language API key\n      - image1 (string): Base64 image data or data URI for first image\n      - image2 (string): Base64 image data or data URI for second image\n      - prompt (string): Text describing how to combine the two images\n\n    Returns:\n      - result (image): Mixed/generated image as base64 string\n    \"\"\"\n    import base64\n    from io import BytesIO\n    from google import genai\n    from google.genai import types\n    from PIL import Image\n\n    # ---- Inputs ----\n    api_key  = (inputs.get('api_key') or '').strip()\n    prompt   = (inputs.get('prompt') or '').strip()\n    image1_b64 = (inputs.get('image1') or '').strip()\n    image2_b64 = (inputs.get('image2') or '').strip()\n\n    # ---- Validate ----\n    missing = []\n    if not api_key:  missing.append(\"api_key\")\n    if not prompt:   missing.append(\"prompt\")\n    if not image1_b64: missing.append(\"image1\")\n    if not image2_b64: missing.append(\"image2\")\n    if missing:\n        raise ValueError(f\"Missing required inputs: {', '.join(missing)}\")\n\n    ctx.log(\"Starting Gemini image mixing...\")\n    ctx.heartbeat()\n\n    # ---- Normalize base64 ----\n    def decode_image(b64_str):\n        if b64_str.startswith(\"data:\"):\n            b64_str = b64_str.split(\",\", 1)[1]\n        return Image.open(BytesIO(base64.b64decode(b64_str)))\n\n    ctx.log(\"Decoding input images...\")\n    img1 = decode_image(image1_b64)\n    img2 = decode_image(image2_b64)\n    ctx.log(f\"Image 1: {img1.size}, Image 2: {img2.size}\")\n\n    # ---- Init Gemini ----\n    ctx.log(\"Initializing Gemini client...\")\n    client = genai.Client(api_key=api_key)\n    ctx.heartbeat()\n\n    # ---- Call Gemini ----\n    ctx.log(f\"Calling Gemini with prompt: {prompt[:100]}...\")\n    response = client.models.generate_content(\n        model=\"gemini-2.5-flash-image-preview\",\n        contents=[prompt, img1, img2],\n    )\n    ctx.heartbeat()\n\n    # ---- Extract images ----\n    ctx.log(\"Extracting generated image from response...\")\n    image_parts = []\n    if response.candidates and len(response.candidates) > 0:\n        candidate = response.candidates[0]\n        if hasattr(candidate, 'content') and hasattr(candidate.content, 'parts'):\n            for part in candidate.content.parts:\n                if hasattr(part, 'inline_data') and part.inline_data:\n                    image_parts.append(part.inline_data.data)\n\n    if not image_parts:\n        raise RuntimeError(\"Gemini returned no image data\")\n\n    # ---- Decode result ----\n    first_image_data = image_parts[0]\n\n    # Handle different data formats from Gemini SDK\n    if isinstance(first_image_data, bytes):\n        try:\n            # Try to decode as ASCII to check if it's base64 text\n            first_image_data.decode('ascii')\n            # If successful, it's base64-encoded bytes\n            first_image_bytes = base64.b64decode(first_image_data)\n        except (UnicodeDecodeError, ValueError):\n            # If decode fails, it's raw binary image data\n            first_image_bytes = first_image_data\n    elif isinstance(first_image_data, str):\n        # Base64 string\n        first_image_bytes = base64.b64decode(first_image_data)\n    else:\n        raise ValueError(f\"Unexpected data type: {type(first_image_data)}\")\n\n    # Open image and convert to PNG\n    img = Image.open(BytesIO(first_image_bytes))\n    buf = BytesIO()\n    img.save(buf, format='PNG')\n    png_bytes = buf.getvalue()\n\n    # Encode to base64\n    result_base64 = base64.b64encode(png_bytes).decode(\"utf-8\")\n\n    ctx.log(\"Gemini image mixing succeeded!\")\n    ctx.heartbeat()\n\n    return {\n        \"result\": result_base64\n    }\n"
  }
}